<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>MiniPOS - Stock Barang</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    header {
      background-color: #4CAF50;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      padding: 20px;
    }

    button {
      padding: 8px 15px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 15px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    .summary {
      margin-top: 15px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      font-weight: bold;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      width: 320px;
      border-radius: 8px;
    }

    .modal-content input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<header>
  <h2>Stock Barang</h2>
  <button onclick="back()">⬅ Dashboard</button>
</header>

<div class="container">
  <button onclick="openModal()">➕ Tambah Barang</button>

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Nama Barang</th>
        <th>Harga</th>
        <th>Jumlah</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="stockList"></tbody>
  </table>

  <!-- Summary -->
  <div class="summary">
    <div>Jumlah Barang: <span id="totalBarang">0</span></div>
    <div>Total Untung Perkiraan: Rp <span id="totalUntung">0</span></div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Tambah Barang</h3>
    <input type="text" id="nama" placeholder="Nama Barang">
    <input type="number" id="harga" placeholder="Harga (Rp)">
    <input type="number" id="jumlah" placeholder="Jumlah">
    <button onclick="tambahBarang()">Simpan</button>
    <button onclick="closeModal()">Batal</button>
  </div>
</div>

<script>
// Proteksi login
if(localStorage.getItem("login")!=="true"){window.location.href="index.html";}

let stock=JSON.parse(localStorage.getItem("stock"))||[];

// Render tabel dan summary
function render(){
  const list=document.getElementById("stockList");
  list.innerHTML="";

  let totalBarang=0;
  let totalUntung=0;

  stock.forEach((item,index)=>{
    list.innerHTML+=`
      <tr>
        <td>${index+1}</td>
        <td>${item.nama}</td>
        <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
        <td>${item.jumlah}</td>
        <td>
          <button onclick="ubah(${index},1)">+</button>
          <button onclick="ubah(${index},-1)">-</button>
        </td>
      </tr>
    `;
    totalBarang+=item.jumlah;
    totalUntung+=Math.round(item.harga*0.3*item.jumlah); // untung 30% dari harga jual
  });

  document.getElementById("totalBarang").innerText=totalBarang;
  document.getElementById("totalUntung").innerText=totalUntung.toLocaleString('id-ID');

  localStorage.setItem("stock",JSON.stringify(stock));
}

// Modal
function openModal(){document.getElementById("modal").style.display="flex";}
function closeModal(){document.getElementById("modal").style.display="none"; document.getElementById("nama").value=""; document.getElementById("harga").value=""; document.getElementById("jumlah").value="";}

// Tambah barang
function tambahBarang(){
  const nama=document.getElementById("nama").value.trim();
  const harga=parseInt(document.getElementById("harga").value);
  const jumlah=parseInt(document.getElementById("jumlah").value);

  if(!nama||isNaN(harga)||isNaN(jumlah)){alert("Semua field wajib diisi!"); return;}

  stock.push({nama,harga,jumlah});
  closeModal();
  render();
}

// Ubah jumlah
function ubah(index,nilai){
  if(stock[index].jumlah+nilai<0) return;
  stock[index].jumlah+=nilai;

  if(stock[index].jumlah===0){
    if(confirm("Hapus barang ini?")) stock.splice(index,1);
  }

  render();
}

function back(){window.location.href="dashboard.html";}

render();
</script>

</body>
</html>
