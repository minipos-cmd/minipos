<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>MiniPOS - Stock Barang</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    header {
      background-color: #4CAF50;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      padding: 20px;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
      margin: 2px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 15px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    .summary {
      margin-top: 15px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      display: flex;
      justify-content: flex-end;
      font-weight: bold;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      width: 320px;
      border-radius: 8px;
      text-align: center;
    }

    .modal-content input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<header>
  <h2>Stock Barang</h2>
  <button onclick="back()">⬅ Dashboard</button>
</header>

<div class="container">
  <button onclick="openModal()">➕ Tambah Barang</button>

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Nama Barang</th>
        <th>Harga</th>
        <th>Jumlah</th>
        <th>Aksi</th>
        <th>Expired</th>
      </tr>
    </thead>
    <tbody id="stockList"></tbody>
  </table>

  <!-- Summary -->
  <div class="summary">
    Total Barang: <span id="totalBarang">0</span>
  </div>
</div>

<!-- Modal Tambah Barang -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Tambah Barang</h3>
    <input type="text" id="nama" placeholder="Nama Barang">
    <input type="number" id="harga" placeholder="Harga (Rp)">
    <input type="number" id="jumlah" placeholder="Jumlah">
    <button onclick="tambahBarang()">Simpan</button>
    <button onclick="closeModal()">Batal</button>
  </div>
</div>

<!-- Modal Tambah Expired -->
<div class="modal" id="modalExpired">
  <div class="modal-content">
    <h3>Tambah Expired</h3>
    <input type="text" id="expiredInput" placeholder="DD,MM,YYYY">
    <button onclick="simpanExpired()">Simpan</button>
    <button onclick="closeModalExpired()">Batal</button>
  </div>
</div>

<script>
// Proteksi login
if(localStorage.getItem("login")!=="true"){window.location.href="index.html";}

let stock = JSON.parse(localStorage.getItem("stock")) || [];
let currentIndexExpired = null; // untuk menyimpan indeks barang yang mau ditambah expired

function render(){
  const list = document.getElementById("stockList");
  list.innerHTML = "";

  let totalBarang = 0;

  stock.forEach((item,index)=>{
    const expiredStr = item.expired ? item.expired.join(" | ") : "";
    list.innerHTML += `
      <tr>
        <td>${index+1}</td>
        <td>${item.nama}</td>
        <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
        <td>${item.jumlah}</td>
        <td>
          <button onclick="ubah(${index},1)">+</button>
          <button onclick="ubah(${index},-1)">-</button>
          <button onclick="openModalExpired(${index})">+ Exp</button>
        </td>
        <td>${expiredStr}</td>
      </tr>
    `;
    totalBarang += item.jumlah;
  });

  document.getElementById("totalBarang").innerText = totalBarang;

  localStorage.setItem("stock", JSON.stringify(stock));
}

// Modal Barang
function openModal(){document.getElementById("modal").style.display="flex";}
function closeModal(){document.getElementById("modal").style.display="none"; document.getElementById("nama").value=""; document.getElementById("harga").value=""; document.getElementById("jumlah").value="";}

// Modal Expired
function openModalExpired(index){
  currentIndexExpired = index;
  document.getElementById("expiredInput").value = "";
  document.getElementById("modalExpired").style.display = "flex";
}
function closeModalExpired(){document.getElementById("modalExpired").style.display = "none";}

// Tambah Barang
function tambahBarang(){
  const nama = document.getElementById("nama").value.trim();
  const harga = parseInt(document.getElementById("harga").value);
  const jumlah = parseInt(document.getElementById("jumlah").value);

  if(!nama || isNaN(harga) || isNaN(jumlah)){alert("Semua field wajib diisi!"); return;}

  stock.push({nama,harga,jumlah,expired:[]});
  closeModal();
  render();
}

// Ubah jumlah
function ubah(index,nilai){
  if(stock[index].jumlah+nilai<0) return;
  stock[index].jumlah += nilai;

  if(stock[index].jumlah === 0){
    if(confirm("Hapus barang ini?")) stock.splice(index,1);
  }

  render();
}

// Simpan expired
function simpanExpired(){
  const val = document.getElementById("expiredInput").value.trim();
  if(!val){alert("Tanggal tidak boleh kosong"); return;}
  if(!stock[currentIndexExpired].expired) stock[currentIndexExpired].expired = [];
  stock[currentIndexExpired].expired.push(val);
  closeModalExpired();
  render();
}

function back(){window.location.href="dashboard.html";}

render();
</script>

</body>
</html>
